name: Build (.NET Framework)
description: Build the solution using MSBuild

runs:
  using: "composite"
  steps:
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v1.0.2
      
    - name: Navigate to Workspace
      run: cd $GITHUB_WORKSPACE

    - name: Create Build Directory
      run: mkdir _build
      
    #- name: Restore Packages
    #  run: nuget restore "SotS Savegame Editor.sln"

    - name: Build Solution
      run: |
        msbuild.exe "SotS Savegame Editor.sln"
        /nologo /nr:false
            /p:DeployOnBuild=true
            /p:DeployDefaultTarget=WebPublish
            /p:WebPublishMethod=FileSystem
            /p:DeleteExistingFiles=True
            /p:platform="Any CPU"
            /p:configuration="Release"
            /p:PublishUrl="../_build"

    - name: Zip artifact for deployment
      run: zip release.zip ../_build/* -r

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: pr/${{ github.event.number }}/release.zip
        path: pr/${{ github.event.number }}/release.zip
        retention-days: 5
