name: Build (.NET Framework)
description: Build the solution using MSBuild

runs:
  using: "composite"
  steps:
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2
      
    - name: Navigate to Workspace
      shell: PowerShell
      run: cd $GITHUB_WORKSPACE

    - name: Create Build Directory
      shell: PowerShell
      run: mkdir ../_build
      
    #- name: Restore Packages
    #  run: nuget restore "SotS Savegame Editor.sln"

    - name: Build Solution
      shell: PowerShell
      run: |
        msbuild.exe "SotS Savegame Editor.sln"
        /nologo /nr:false
            /p:DeployOnBuild=true
            /p:DeployDefaultTarget=WebPublish
            /p:WebPublishMethod=FileSystem
            /p:DeleteExistingFiles=True
            /p:platform="Any CPU"
            /p:configuration="Release"
            /p:PublishUrl="../_build"

    - name: Zip artifact for deployment
      shell: PowerShell
      run: |
        $compress = @{
          Path = "../_build/*"
          CompressionLevel = "Fastest"
          DestinationPath = "pr/${{ github.event.number }}/release.zip"
        }
        Compress-Archive @compress

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: release.zip
        path: pr/${{ github.event.number }}/release.zip
        retention-days: 5
